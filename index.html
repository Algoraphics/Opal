<!DOCTYPE html>
<html>
  <head>
    <title>Road.</title>
    <meta name="description" content="Road.">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component/dist/aframe-animation-component.min.js"></script>
    <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
    <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>
    <script src="components/includes.js"></script>
    <!-- My files -->
    <script src="components/entity-generator.js"></script>
    <script src="components/worldbuilders.js"></script>
    <script src="components/stuff.js"></script>
    <script src="components/colors.js"></script>
    <script src="components/rng.js"></script>
    
    <!-- Custom shaders -->
    <script src="shaders.js"></script>
    
    <!-- Main menu buttons -->
    
    <!-- TODO use shader building, geometry on regular building messes with cursor fuse -->
    <script id="start-link" type="text/html">
      <a-entity class="link" justrotate
        building="height: 2; optimize: false; color1: #FFFF00; colortype: none"
        menu-manager="action: start">
      </a-entity>
    </script>
    <script id="fractal-link" type="text/html">
      <a-entity class="link" id="fractal"
        rng-shader="shader: fractal-test; width: 10; shape: 0 1 0; resolution: 0 0 1 0;"
        menu-manager="action: surround">
      </a-entity>
    </script>
    <script id="ganzfeld-link" type="text/html">
      <a-entity class="link"
        geometry="primitive: sphere; radius: 5"
        material="shader: flat; color: #FF0000; side: double"
        menu-manager="action: surround">
      </a-entity>
    </script>
    <script id="about-link" type="text/html">
      <a-entity class="link"
        geometry="primitive: circle; radius: 3.5"
        material="shader: flat; src: ${thumb}; side: double"
        menu-manager="action: about">
      </a-entity>
    </script>
    <script id="back-link" type="text/html">
      <a-entity class="link"
        geometry="primitive: box; width: 0.6; height: auto; depth: -0.1" 
        material="color: black; opacity: 0.5"
        text="value: Back to menu; width: 2; color: white; align: center"
        menu-manager="action: back">
      </a-entity>
    </script>
  </head>
  <body>
    <a-scene id="fog" fog="type: exponential; density: 0.035; color: #101010"
             animation__fog="property: fog.density; easing: easeOutCirc; to: 0.0; dur: 40000; startEvents: donedancing">
      <a-assets>
        <img id="stars" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fstarfield.png?1513307410255">
        <img id="green" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fgreenfield.jpg?1513824807936">
        <img id="sunset" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2FSunset1.jpg?1513822555974">
        <img id="sunset2" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fsunset_smudge.jpg?1513829169610">
        <img id="sunsetblur" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fsunset_blur.jpg?1513871737795">
        <img id="milky" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2F16025063950_61e0c94540_o.jpg?1513823844529">
        <img id="convertible" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2FConvertible%20Texture.png?1518654790714">
        <img id="exbot" crossorigin="anonymous" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2FExbot2.jpg?1518661785572">
        
        <audio id="side" src="https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fside-of-the-road%5BMp3-Gratis.eu%20-%20Download%20Free%20Mp3%5D.mp3?1514392665329"></audio>
        
        <a-mixin id="rainbow" rainbowcycle="speed: 3"></a-mixin>
        <a-mixin id="alterColors" animation="property: material.color; dir: alternate; dur: 594.06; easing: easeInOutSine; loop: true; to: #FF00FF"></a-mixin>
        <a-mixin id="scale" animation__scale= "property: scale; dir: alternate; dur: 297.03; easing: easeInSine; loop: true; to: 1.2 1 1.2"       ></a-mixin>
        <a-mixin id="cubes"
          geometry="primitive: box; height: 0.5; width: 0.5; depth: 0.5"
          material="color: #0000FF; shader: flat"
        ></a-mixin>
        
        <a-mixin id="window"
          material="color: #FFFF00; shader: flat"></a-mixin>
        <a-mixin id="rect" mixin="window"
          geometry="primitive: plane; width: 1; height: 2;"></a-mixin>
        <a-mixin id="circle" mixin="window"
          geometry="primitive: circle; radius: 0.75;"></a-mixin>
        <a-mixin id="triangle" mixin="window" rotation="0 0 180"
          geometry="primitive: triangle;" scale="3 3 2"></a-mixin>
        <a-mixin id="diamond" mixin="window" rotation = "0 0 45"
          geometry="primitive: plane; width: 1.5; height: 1.5" scale="1.25 1.25 1"></a-mixin>
        <a-mixin id="bars" mixin="window" rotation = "0 0 0"
          geometry="primitive: plane; width: 2.5; height: 1.5;"></a-mixin>
        <a-mixin id="windows" entity-colors="mixin: rect; num: 4; color_type: flip; slower: 1; every: 2; 
                                             fromcolor: #00FF00; tocolor: #FF0000; alternate: false" 
                 layout="type: box; columns: 2; marginRow: 4; marginColumn: 3">
        </a-mixin>     
        <a-mixin id="buildingblock" entity-circle="mixin: windows; num: 3; axis: y; angle: 90;" layout="type: building; radius: 1"
             geometry="primitive: box; width: 6.8; height: 7.5; depth: 6.8" material="color: #000000"></a-mixin>
        <a-mixin id="building" building-builder></a-mixin>
        
        <a-mixin id="roadash" geometry="primitive: plane; width:0.25; height:2" material="color: #ffdf00; shader: flat" rotation="0 0 90"></a-mixin>
        <a-mixin id="spot" light="type: spot; castShadow: true; angle: 30; color: #FFFF00"></a-mixin>
        <a-mixin id="lit" geometry="primitive:circle; radius: 5"
                 material="color: #fdffa3; shader:flat; opacity: 0.5 transparent:true; src:https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fwhiteblur.png?1513817944824"></a-mixin>
        <a-mixin id="lcone" geometry="primitive:cone; radiusBottom: 3; height: 8" material="color: #fdffa3; opacity: 0.5"></a-mixin>
        <a-mixin id="lamp" scale="2 2 2" gpoly="polyid:awUS2qoxeSa; API_KEY:AIzaSyAJ19aF1HSKdyzV4-OKtITR2MoKkSkh7rQ;"></a-mixin>
        <a-mixin id="blur" scale="0.8 0.8" geometry="primitive:plane" 
                 material="color: #fdffa3; shader:flat; transparent:true; src:https://cdn.glitch.com/c43f301b-a64d-4479-87e0-4646a6a065cb%2Fwhiteblur.png?1513817944824"></a-mixin>
        <a-mixin id="car" crossorigin="anonymous" scale="0.03 0.03 0.03" gpoly="polyid:8ACz9InIO0c; API_KEY:AIzaSyAJ19aF1HSKdyzV4-OKtITR2MoKkSkh7rQ;"></a-mixin>
      <!--
      Comment section
      entity-generator="mixin: window; num: 16; rainbow: true; speed: 10"
      <a-mixin id="rotating" animation__rotate="property: rotation; easing: easeInOutSine; dir: alternate; dur: 8000; loop: true; to: 0 360 0"></a-mixin>
       <a-entity slide="speed: 0" entity-generator="mixin: spot; num: 5" layout="type: line; margin: 10" position="0 0.75 -0.2" rotation="0 0 0" scale="5 5 5" src="#blur-image" color="#FFFF00"></a-entity>
      <a-plane rainbowcycle="offset: 200; speed: 30" visible="false" position="2 0 -5" rotation="0 0 0" width="5" height="2" shader="flat" shadow></a-plane>
      <a-sky visible="true" id="image-360" src="#green" radius="1000" rotation="30 0 0" position="0 0 0"></a-sky>
      entity-generator="mixin: lamp blur, lcone lit"
      -->
      </a-assets>   
      
      <a-sky visible="true" id="image-360" src="#sunsetblur" radius="5000" rotation="0 -60 0" position="0 -50 0"></a-sky>
      <a-entity light="type: ambient; intensity: 0.3; distance: 50; decay: 2" position="0 10 10"></a-entity>
      
      <a-plane id="floor" position="0 0 0" rotation="-90 0 0" width="10000" height="10000" color="#303030"></a-plane>
      <a-plane id="road" position="0 0.05 0" rotation="-90 0 0" width="8" height="2890" color="#606060"></a-plane>
      
      <a-entity id="roadline1" followcamera="length:400; reverse: true; stopfollow: -1200"
                entity-colors="analyserEl: #analyser; max: 50; multiplier: 0.01; 
                               mixin: roadash; num: 25; color_type: none; slower: 4; reverse: true;
                               audio_property: position; audio_levels: true; audio_buildup: 1;"
                layout="type: line; margin: 10" position="0 0.1 -40" rotation="-90 -90 0"></a-entity>
      <a-entity id="roadline2" followcamera="length:400; reverse: true; stopfollow: -1200"
                entity-colors="analyserEl: #analyser; max: 50; multiplier: 0.01; 
                               mixin: roadash; num: 25; color_type: none; slower: 4;
                               audio_property: position; audio_levels: true; audio_buildup: 1;"
                layout="type: line; margin: 10" position="0 0.1 -40" rotation="-90 -90 0"></a-entity>
      
      
      <a-entity id="streetlightsright" position="4 0 125" rotation="0 90 0"
                entity-generator-merger="num: 6; mixins: blur, lamp, lcone, lit; 
                                         positions: 0 5.83 -0.4, 0 4.5 0, 0 2.2 -1.35, 0 0.1 -2; 
                                         rotations: 90 0 0, 0 0 0, 15 0 0, -90 0 0
                                         layout_type:line; layout_margin: 50; flip_reverse: true"
                                         followcamera="length: 250; stopfollow: -800"></a-entity>
      <a-entity id="streetlightsleft" position="-4 0 -50" rotation="0 -90 0"
                entity-generator-merger="num: 6; mixins: blur, lamp, lcone, lit; 
                                         positions: 0 5.83 -0.4, 0 4.5 0, 0 2.2 -1.35, 0 0.1 -2; 
                                         rotations: 90 0 0, 0 0 0, 15 0 0, -90 0 0
                                         layout_type:line; layout_margin: 50; flip_delay: 0.25; flip_shift: 0"
                                         followcamera="length: 250; reverse: true; stopfollow: -800"></a-entity>
      <!-- comment starter
      Check position of something
      
      Fractals!
      <a-entity id="fractal2" rng-shader="shader: fractal-test; width: 3; height: 4; shape: 0 1 0; resolution: 0 0 1 0;" position="0 3 10" rotation="0 -90 180"></a-entity>
      <a-entity id="fractal" rng-shader="shader: fractal-test; width: 3; height: 4; shape: 0 1 0; resolution: 0 0 1 0; speed: 0 1 0;" position="0 1000 10" rotation="0 -90 180"
                class="beatlistener150" animation__move="property: position; from: 0 10000 -1550; to: 0 25 -1550; easing: easeOutCubic; dur: 30000; startEvents: beat"
                                        animation__scale="property: scale; from: 50 50 50; to: 5 5 5; easing: linear; dur: 35000; startEvents: beat"></a-entity>-->

      <a-entity visible="false" worldbuilder=" buildingfunction: colorCity; 
                              blockx: 5; blockz: 15; numblockx: 4; numblockz: 4; gapwidth: 2; 
                              widthprobs: 0.15 0.2 0.15 0.1 0.05; maxheight: 7; heightprobs: 1 1 1 1 1 1 1;
                              loadmult: 4; stopfollow: -200;"
                class="beatlistener116" rotation = "0 0 0" position="-62 -350 -1245" scale = "1 1 1"></a-entity>
      
      <a-entity visible="false" worldbuilder=" buildingfunction: movingCity;
                                  blockx: 4; blockz: 10; grid: 30; buildgrids: false; loadmult: 1.5; stopfollow: -500; unload: -600"
                animation__rise="property: position; from: -48 -12 -370; to: -48 0 -370; easing: easeInCubic; dur: 594.059; startEvents: beat"
                class="beatlistener32" position = "-48 -12 -370" rotation = "0 0 0"></a-entity>
      
      <a-plane id="grid" timedvisible position="0 0.025 -6450" rotation="-90 1 0" width="10000" height="10000" class="beatlistener130"
               material="shader: grid-shader; resolution: 1000.0; intensity: 10.0; speed: 0.5; color: #FFFF00; backgroundColor: #606060"></a-plane>
      <!-- comment stopper -->
      
      <a-entity id="camera" camera="userHeight: 1.6; near: 0.5" my-look-controls wasd-controls="acceleration: 500;" 
                camera-manager="speed: 12; rise: -900; stop: -1550" position="0 0 110" rotation="0 0 0">
        <a-cursor id="cursor" material="color: gray"
          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
          animation__defusing="property: scale; startEvents: mouseleave; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          event-set__1="_event: mouseenter; color: springgreen"
          event-set__2="_event: mouseleave; color: gray;"
          fuse="true"
          raycaster="objects: .link">
        </a-cursor>
        <a-entity id="click-instruction" text="value: Click to use VR cursor.\n\nHover to select. \nESC to unlock cursor.; color: orange; align: center"
                  scale="2 2 2" position="0 -0.05 -2" rotation="0 0 0" animation__opacity="property: text.opacity; from: 0; to: 1; dur: 10000"></a-entity>
      </a-entity>
      <a-entity id="menu" camera-manager="speed: 12" position="0 2.75 107" rotation="0 0 0">
        <a-entity id="menu-layout" layout="type: circle; radius: 15" scale="0.1 0.1 0.1">
          <a-entity template="src: #fractal-link"></a-entity>
          <a-entity template="src: #about-link" data-thumb="#exbot"></a-entity>
          <a-entity template="src: #ganzfeld-link"></a-entity>
          <a-entity template="src: #start-link"></a-entity>
        </a-entity>
        <a-entity id="back" active="false" template="src: #back-link" scale="1 1 1" position="0 -10 2" rotation="-20 0 0"></a-entity>
      </a-entity>
      
      
      <a-entity id="analyser" audioanalyser="src: #side; enableBeatDetection: false;" ></a-entity>
      <a-entity music-manager="startpos: -50; showbeats: true"></a-entity>
      <!--
      <a-entity camera-manager="speed: 12" menu-manager position="0 3 110"></a-entity>
      <a-entity camera-manager="speed: 12" entity-colors="mixin: car; num: 1" position="2 1.5 105" rotation="0 180 0"></a-entity>
      <a-box material="color:red" audio-react="analyserEl: #analyser" position="0 2 8.5"></a-box>

      <!-- beat: 594.059 half beat: 297.029 totalbeats: 464 camera-speed: 12 -->
    </a-scene>
  </body>
</html>